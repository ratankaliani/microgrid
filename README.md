# MicroGrid
## Project Description
### Executive Summary
MicroGrid is a U.S. P2P energy sharing platform that creates a competitive energy market with dynamic pricing built on the EW-DOS infrastructure. In this system, government regulated energy monopolies and individual energy producers sell on the same market through the existing power grid. We deliver competitive prices to retail consumers by leveraging the existing non-competitive surplus renewable energy market. MicroGrid will integrate with EW Origin such that producers may sell energy attribute certificates (EAC) and/or EWT tokens. Self-sovereign decentralized identifiers (SSI) will enable simple supplier switching as users build their identities with transaction histories and other personal tokens. MicroGrid can reduce the need for aggregated DER amounts in a marketplace (as seen with Community Choice Aggregation & California's DRAM program) by leveraging smart contract-based Distributed Energy Resource Management Systems (DERMS).

### Background
Traditionally, when households consume electricity their cost is based on the locational marginal pricing calculated by centralized providers like PG&E. As a result of the large fixed costs to build the infrastructure and complex distribution systems, grid operators often form natural monopolies with government subsidies. While they are price regulated, their electricity buy and sell prices still have a huge spread (around 3¢/kWh vs. 20¢/kWh). Furthermore, net metering programs fail to offer the full extent of financial incentives possible to communities. While prosumers (defined as energy consumers capable of producing energy with renewable DERs) receive retail rate kWh credit through net metering 2.0, neighbors who do not produce energy are paying higher retail rates for that same amount because they are not eligible for the same plans (e.g. EV2-A, EV2-B). Therefore, MicroGrid works such that with PG&E's current rate plans, EV owners would still be incentivized to charge at night (so as to protect against overloading grid infrastructure) and solar panel owners would profit more by selling to non-EV2-A/EV2-B consumers.

### Concept & Commercialization
When a prosumer generates power, excess (defined as amounts not expended by the producer in the moment of generation) will be either a) stored in a personal battery supply for later use/sale, b) sent directly to the grid for a net metering/automatic smart contract transaction, or c) stored in a community battery shared between residents for later use/sale (Community Choice Aggregation inspired). Multiple oracles (meter, energy provider billing, SSI information) will be necessarily be trusted in aggregate to determine excess energy ownership of a prosumer. An off-chain automatic trading algorithm tuned to seller pricing preferences will identify a) local buyers willing to pay more than net metering rates, or b) parties interested in purchasing EACs (EW Origin). Buyers participating in this system will automatically submit bids according to rates being paid at the moment, recycled at a pre-set interval. With the P2P market force, both the supply and the demand side can trade energy at a better price. Once a match is identified, the transaction will pseudonymously be rolled up with others occuring near the same moment (increasing privacy) and excecuted as a smart contract on-chain (EW Chain). Grid operators will receive royalties on all transactions for infrastructure ownership. Sellers without battery storage options will only have the option to take trades available at time of generation. This solution generates the possibility of P2P energy trading, but when the market is illiquid or when the price is not ideal, people can still choose to buy/sell energy with centralized firms as they used to do. A key advantage of using the EW-DOS infrastructure for this design is the reliability that comes with a consortium of reputable energy advocates that can validate transactions instead of a single provier. Participants do not necessarily need to host their own node, however can still engage in a more affordable, democratic market. Commercialization could come from several possible avenues, we propose either an initial onboarding fee for neighbors to participate in P2P trading or adding to the proposed energy provider royalty fee. 

### User Flow
The user flow will begin with the authentication login page. Once a user logs in, they will be taken to a splash page showing several “feeds”. One will be a catalog of energy shares that have been bought, one will be a catalog of energy shares that have been sold, and below both feeds will be a variety of metrics that indicate user “performance” over time. These metrics in specific will be determined after evaluating what information is valuable to users; one example is a line graph showing surplus energy held over time so users can determine whether their buy/sell strategy is wasteful or on-par with their expectations. The visual portrayals of these metrics will provide important information that will help users contextualize the value of energy they are trading through methods like translating energy amounts into recognizable figures (e.g. “You sold enough energy last month to power an 8-floor apartment building!”). A settings page will allow users to edit profile information and adjust two key metrics: their maximum buying price and minimum selling price. Since MicroGrid's primary function is automated energy sharing (which is dependent on SSI data), users will be prompted to permit 3rd party automated trading. We plan to perform exhaustive user testing in both Figma and our fully developed application for usability and feedback in low-fidelity and high-fidelity iterations.

<sub>Click below for a short demo</sub><br>
<sub>Note: Does not include SSI/EAC/automation, MongoDB backend</sub><br>
[<img src="https://saahilshangle.github.io/images/microgrid_home.jpg" width="50%" length="50%"/>](https://www.youtube.com/watch?v=abb4BOO2_os)

### Architecture
This platform will assign individual energy producers and consumers to microgrid regions where sellers and buyers are matched off-chain. Information about producers' excess energy at any given point in time will be stored in a database. Centralized (e.g. MongoDB) and distributed (e.g. Amazon Redshift) solutions would offer scalability and efficiency. However, a decentralized database (e.g. Orbit DB) would be more in line with the EW-DOS vision given the absence of a central point of failure. For the purposes of our PoC shown above, a centralized database is used for simplicity. MicroGrid may migrate to EW-DOS's Key-Value-Store in the future to fully integrate the EW framework. We then utilize blockchain to execute energy transactions and maintain a complete record of them. EW-Chain smart contracts will handle the exchange of energy rights with EWT/EAC ERC-721 tokens. However, the user experience will be largely abstracted away from the blockchain, and transactions are automated to minimize costs through a continuous process of dynamic energy pricing. A decentralized ledger provides transparent pseudonymous neighbor to neighbor energy management that significantly reduces reliance and expected costs associated with a single energy provider. A web interface will abstract low level blockchain computation, and assist the user in understanding their energy transactions on the microgrid. The implementation of the full-stack dApp demo shown above was built using the MongoDB, Express.js, React.js, Node.js, Provable, and Solidity/Ethereum frameworks. Our front-end application was built entirely in React.

<sub>Click below for a full deck</sub><br>
[<img src="https://saahilshangle.github.io/images/dapp_flow.jpg" width="45%" length="45%"/>](https://docs.google.com/presentation/d/1NNWVx2BMPqyycyE4lmdhekEvGsu1hgPRqYgJBBLIQYQ/edit?usp=sharing) [<img src="https://saahilshangle.github.io/images/tech_architecture.jpg" width="45%" length="45%"/>](https://docs.google.com/presentation/d/1NNWVx2BMPqyycyE4lmdhekEvGsu1hgPRqYgJBBLIQYQ/edit?usp=sharing)

### Smart Contract
For our beta application, we implemented a basic set of security features using the Provable API. Once we migrate to Chainlink in order to develop on Volta, we will be able to succesfully connect the powerwall.

[<img src="https://saahilshangle.github.io/images/smart_contract.jpg" width="65%" length="65%"/>](https://docs.google.com/presentation/d/1NNWVx2BMPqyycyE4lmdhekEvGsu1hgPRqYgJBBLIQYQ/edit?usp=sharing)<br>
<sub>Note: Pseudocode used for ease of explanation</sub>


Some key improvements from our PoC include:
* **MicroGrid API**: Code refactoring into a more Service Oriented Architecture (SOA), so as to ease the implementation of simplified APIs to expose grid congestion data, core metrics, audit information etc.
* **Audit Dashboard**: In order for grid/infrastructure owners such as PG&E to effectively audit our blockchain's record and prevent against double-charging MicroGrid users, their staff will need user-friendly dashboards to monitor all financial transactions across our network.
* **Sensor Integration**: Building and/or purchasing the hardware and sensors needed to accurately meter the electricity flow in and out of households/batteries, and writing the necessary IoT scripts to communicate seamlessly with our smart contract.
* **Automation**: Lifting the burden of daily/weekly energy trading off the shoulders of users by automating matching buyers/vendors and executing transactions according to configurable trading agents.
* **Simulation**: Designing the user/grid simulations needed to model grid congestion, user activity, time, etc. in order to stress test our software and its capabilities before releasing to production.
* **Tokenization**: Migrating to EWT as a store of value.
